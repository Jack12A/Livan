<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Nick Encrypter</title>

<style>
body{
    margin:0;
    font-family:"Segoe UI",system-ui,sans-serif;
    background:linear-gradient(135deg,#0b1220,#1f2937);
    color:white;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
}

.card{
    width:920px;
    max-width:95%;
    background:#111827;
    border-radius:20px;
    padding:28px;
    box-shadow:0 20px 60px rgba(0,0,0,.6);
}

h1{
    text-align:center;
    margin-bottom:15px;
}

textarea{
    width:100%;
    height:120px;
    background:#0f172a;
    border:1px solid #334155;
    border-radius:12px;
    color:white;
    padding:12px;
    resize:vertical;
}

input,.dropzone{
    width:100%;
    margin-top:10px;
    padding:10px;
    background:#0f172a;
    border:1px solid #334155;
    border-radius:12px;
    color:white;
}

.dropzone{
    border:2px dashed #475569;
    text-align:center;
    cursor:pointer;
    transition:.2s;
}
.dropzone:hover{
    border-color:#3b82f6;
}

.buttons{
    display:flex;
    gap:10px;
    margin-top:12px;
}

button{
    flex:1;
    padding:10px;
    border:none;
    border-radius:12px;
    background:#6366f1;
    color:white;
    cursor:pointer;
    font-weight:600;
}

button:hover{
    background:#4f46e5;
}

.secondary{
    background:#475569;
}

footer{
    text-align:center;
    font-size:12px;
    opacity:.6;
    margin-top:14px;
}
</style>
</head>

<body>
<div class="card">

<h1>üîê Nick Encrypter</h1>

<!-- TEXT -->
<textarea id="input" placeholder="Type or paste text here..."></textarea>
<input type="password" id="textPass" placeholder="Text password">

<div class="buttons">
<button onclick="encryptText()">Encrypt Text</button>
<button onclick="decryptText()">Decrypt Text</button>
<button class="secondary" onclick="copyOutput()">Copy</button>
</div>

<textarea id="output" placeholder="Text output..." readonly></textarea>

<br><br>

<!-- FILE -->
<input type="password" id="filePass" placeholder="File password">

<div id="dropzone" class="dropzone">
üìÅ Click or Drag & Drop file here
</div>

<input type="file" id="fileInput" hidden>

<div class="buttons">
<button onclick="encryptFile()">Encrypt File</button>
<button onclick="decryptFile()">Decrypt File</button>
</div>

<footer>.Nick-encryption ‚Ä¢ AES-256-GCM ‚Ä¢ PBKDF2 ‚Ä¢ Made by Jack Meersman</footer>

</div>

<script>
/* ================= CONFIG ================= */
const HEADER = new TextEncoder().encode("NICKENC");

const enc = new TextEncoder();
const dec = new TextDecoder();

/* ================= ELEMENTS ================= */
const input = document.getElementById("input");
const output = document.getElementById("output");
const textPass = document.getElementById("textPass");
const filePass = document.getElementById("filePass");

const dropzone = document.getElementById("dropzone");
const fileInput = document.getElementById("fileInput");

let selectedFile = null;

/* ================= FILE PICKER ================= */
dropzone.onclick = () => fileInput.click();

fileInput.addEventListener("change", e => {
    selectedFile = e.target.files[0];
    if(selectedFile)
        dropzone.innerText = "Selected: " + selectedFile.name;
});

dropzone.ondragover = e => e.preventDefault();

dropzone.ondrop = e => {
    e.preventDefault();
    selectedFile = e.dataTransfer.files[0];
    dropzone.innerText = "Selected: " + selectedFile.name;
};

/* ================= CRYPTO ================= */
async function getKey(password, salt){
    const base = await crypto.subtle.importKey(
        "raw", enc.encode(password), "PBKDF2", false, ["deriveKey"]
    );

    return crypto.subtle.deriveKey(
        {name:"PBKDF2", salt, iterations:100000, hash:"SHA-256"},
        base,
        {name:"AES-GCM", length:256},
        false,
        ["encrypt","decrypt"]
    );
}

/* ================= TEXT ================= */
async function encryptText(){
    const salt = crypto.getRandomValues(new Uint8Array(16));
    const iv   = crypto.getRandomValues(new Uint8Array(12));

    const key = await getKey(textPass.value, salt);

    const cipher = await crypto.subtle.encrypt(
        {name:"AES-GCM", iv},
        key,
        enc.encode(input.value)
    );

    output.value = btoa(
        String.fromCharCode(...salt, ...iv, ...new Uint8Array(cipher))
    );
}

async function decryptText(){
    const data = Uint8Array.from(atob(input.value), c=>c.charCodeAt(0));

    const salt = data.slice(0,16);
    const iv   = data.slice(16,28);
    const cipher = data.slice(28);

    const key = await getKey(textPass.value, salt);

    const plain = await crypto.subtle.decrypt(
        {name:"AES-GCM", iv},
        key,
        cipher
    );

    output.value = dec.decode(plain);
}

function copyOutput(){
    navigator.clipboard.writeText(output.value);
}

/* ================= FILE ================= */
async function encryptFile(){
    if(!selectedFile) return alert("Choose a file first");

    const data = new Uint8Array(await selectedFile.arrayBuffer());

    const salt = crypto.getRandomValues(new Uint8Array(16));
    const iv   = crypto.getRandomValues(new Uint8Array(12));
    const key  = await getKey(filePass.value, salt);

    const cipher = new Uint8Array(
        await crypto.subtle.encrypt({name:"AES-GCM", iv}, key, data)
    );

    download(
        new Uint8Array([...HEADER, ...salt, ...iv, ...cipher]),
        selectedFile.name + ".Nick-encryption"
    );
}

async function decryptFile(){
    if(!selectedFile) return alert("Choose a file first");

    const data = new Uint8Array(await selectedFile.arrayBuffer());

    const salt = data.slice(7,23);  // HEADER length = 7
    const iv   = data.slice(23,35);
    const cipher = data.slice(35);

    const key = await getKey(filePass.value, salt);

    const plain = await crypto.subtle.decrypt(
        {name:"AES-GCM", iv},
        key,
        cipher
    );

    download(plain, selectedFile.name.replace(".Nick-encryption",""));
}

function download(data,name){
    const a = document.createElement("a");
    a.href = URL.createObjectURL(new Blob([data]));
    a.download = name;
    a.click();
}
</script>
</body>
</html>
