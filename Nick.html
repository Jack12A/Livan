<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Nick Encrypter</title>

<style>
body{
    margin:0;
    font-family:"Segoe UI",system-ui,sans-serif;
    background:linear-gradient(135deg,#0b1220,#1b2436);
    color:white;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
}

.card{
    width:900px;
    max-width:95%;
    background:#111827;
    padding:30px;
    border-radius:18px;
    box-shadow:0 20px 60px rgba(0,0,0,.6);
}

h1{
    text-align:center;
    margin-bottom:15px;
}

textarea{
    width:100%;
    height:130px;
    background:#0f172a;
    color:white;
    border:1px solid #334155;
    border-radius:12px;
    padding:10px;
    resize:none;
}

input{
    width:100%;
    margin-top:10px;
    padding:10px;
    background:#0f172a;
    border:1px solid #334155;
    border-radius:12px;
    color:white;
}

.drop{
    margin-top:12px;
    border:2px dashed #475569;
    padding:18px;
    text-align:center;
    border-radius:12px;
    cursor:pointer;
}

.buttons{
    display:flex;
    gap:10px;
    margin-top:12px;
}

button{
    flex:1;
    padding:10px;
    border:none;
    border-radius:12px;
    background:#3b82f6;
    color:white;
    cursor:pointer;
    font-weight:600;
}

button:hover{
    background:#2563eb;
}

footer{
    margin-top:12px;
    text-align:center;
    font-size:12px;
    opacity:.6;
}
</style>
</head>

<body>
<div class="card">

<h1>üîê Nick Encrypter</h1>

<textarea id="text" placeholder="Type or paste text here..."></textarea>

<input type="password" id="pass" placeholder="Password / Key">

<div class="buttons">
    <button onclick="encryptText()">Encrypt Text</button>
    <button onclick="decryptText()">Decrypt Text</button>
    <button onclick="copyOut()">Copy</button>
</div>

<textarea id="output" placeholder="Output..." readonly></textarea>

<div class="drop" id="drop">
üìÅ Click or Drag & Drop files (.Nick-encryption)
</div>
<input type="file" id="file" hidden>

<footer>
AES-256-GCM ‚Ä¢ PBKDF2 ‚Ä¢ Custom Nick Encryption Format
</footer>

</div>

<script>
/* ===============================
   CONFIG
================================ */
const HEADER = new TextEncoder().encode("NICKENC"); // magic signature

const enc = new TextEncoder();
const dec = new TextDecoder();

const textBox = document.getElementById("text");
const output = document.getElementById("output");
const pass = document.getElementById("pass");

/* ===============================
   KEY DERIVATION
================================ */
async function getKey(password, salt){
    const baseKey = await crypto.subtle.importKey(
        "raw", enc.encode(password), "PBKDF2", false, ["deriveKey"]
    );

    return crypto.subtle.deriveKey({
        name:"PBKDF2",
        salt,
        iterations:100000,
        hash:"SHA-256"
    }, baseKey, {
        name:"AES-GCM",
        length:256
    }, false, ["encrypt","decrypt"]);
}

/* ===============================
   TEXT MODE
================================ */
async function encryptText(){
    if(!textBox.value || !pass.value) return alert("Enter text and password");

    const salt = crypto.getRandomValues(new Uint8Array(16));
    const iv   = crypto.getRandomValues(new Uint8Array(12));
    const key  = await getKey(pass.value, salt);

    const cipher = await crypto.subtle.encrypt(
        {name:"AES-GCM", iv},
        key,
        enc.encode(textBox.value)
    );

    const merged = new Uint8Array([...salt,...iv,...new Uint8Array(cipher)]);
    output.value = btoa(String.fromCharCode(...merged));
}

async function decryptText(){
    try{
        const data = Uint8Array.from(atob(textBox.value), c=>c.charCodeAt(0));

        const salt = data.slice(0,16);
        const iv   = data.slice(16,28);
        const cipher = data.slice(28);

        const key = await getKey(pass.value, salt);

        const plain = await crypto.subtle.decrypt(
            {name:"AES-GCM", iv},
            key,
            cipher
        );

        output.value = dec.decode(plain);
    }catch{
        alert("Invalid password or data");
    }
}

function copyOut(){
    navigator.clipboard.writeText(output.value);
}

/* ===============================
   FILE MODE
================================ */
const drop = document.getElementById("drop");
const fileInput = document.getElementById("file");

drop.onclick = ()=> fileInput.click();

drop.ondragover = e => e.preventDefault();

drop.ondrop = e=>{
    e.preventDefault();
    handleFile(e.dataTransfer.files[0]);
};

fileInput.onchange = e=>{
    handleFile(e.target.files[0]);
};

async function handleFile(file){
    if(!pass.value) return alert("Enter password first");

    const data = new Uint8Array(await file.arrayBuffer());

    const isNick =
        data.length > 7 &&
        HEADER.every((v,i)=>data[i]===v);

    if(isNick) decryptFile(data,file.name);
    else encryptFile(data,file.name);
}

async function encryptFile(data,name){
    const salt = crypto.getRandomValues(new Uint8Array(16));
    const iv   = crypto.getRandomValues(new Uint8Array(12));
    const key  = await getKey(pass.value, salt);

    const cipher = new Uint8Array(await crypto.subtle.encrypt(
        {name:"AES-GCM", iv}, key, data
    ));

    const out = new Uint8Array([...HEADER,...salt,...iv,...cipher]);

    download(out, name + ".Nick-encryption");
}

async function decryptFile(data,name){
    try{
        const salt = data.slice(7,23);
        const iv   = data.slice(23,35);
        const cipher = data.slice(35);

        const key = await getKey(pass.value, salt);

        const plain = await crypto.subtle.decrypt(
            {name:"AES-GCM", iv},
            key,
            cipher
        );

        download(plain, name.replace(".Nick-encryption",""));
    }catch{
        alert("Wrong password or corrupted file");
    }
}

function download(data,name){
    const blob = new Blob([data]);
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = name;
    a.click();

    URL.revokeObjectURL(url);
}
</script>
</body>
</html>
