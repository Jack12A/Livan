<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Livanannese Encrypter</title>
<style>
body{font-family:Segoe UI;background:#0f172a;color:white;text-align:center;padding:40px}
button,input{margin:6px;padding:8px;border-radius:8px;border:none}
textarea{width:90%;height:120px;margin:6px;background:#111827;color:white}
.drop{border:2px dashed #555;padding:20px;margin:10px;cursor:pointer}
</style>
</head>
<body>

<h2>üîê Livanannese Encrypter</h2>

<textarea id="text"></textarea><br>
<input type="password" id="pass" placeholder="Password"><br>
<button onclick="encryptText()">Encrypt</button>
<button onclick="decryptText()">Decrypt</button>

<div class="drop" id="drop">Drop file here</div>
<input type="file" id="file" hidden>

<script>
const HEADER = new TextEncoder().encode("LIVANENC");

const enc=new TextEncoder(), dec=new TextDecoder();

async function key(pass,salt){
 let k=await crypto.subtle.importKey("raw",enc.encode(pass),"PBKDF2",false,["deriveKey"]);
 return crypto.subtle.deriveKey(
 {name:"PBKDF2",salt,iterations:100000,hash:"SHA-256"},
 k,{name:"AES-GCM",length:256},false,["encrypt","decrypt"]);
}

async function encryptText(){
 let salt=crypto.getRandomValues(new Uint8Array(16));
 let iv=crypto.getRandomValues(new Uint8Array(12));
 let k=await key(pass.value,salt);
 let c=await crypto.subtle.encrypt({name:"AES-GCM",iv},k,enc.encode(text.value));
 text.value=btoa(String.fromCharCode(...salt,...iv,...new Uint8Array(c)));
}

async function decryptText(){
 let data=Uint8Array.from(atob(text.value),c=>c.charCodeAt(0));
 let salt=data.slice(0,16), iv=data.slice(16,28), cipher=data.slice(28);
 let k=await key(pass.value,salt);
 let p=await crypto.subtle.decrypt({name:"AES-GCM",iv},k,cipher);
 text.value=dec.decode(p);
}

const drop=document.getElementById("drop"), file=document.getElementById("file");
drop.onclick=()=>file.click();

file.onchange=e=>handle(e.target.files[0]);
drop.ondrop=e=>{e.preventDefault();handle(e.dataTransfer.files[0])};
drop.ondragover=e=>e.preventDefault();

async function handle(f){
 let buf=new Uint8Array(await f.arrayBuffer());
 if(buf.slice(0,8).every((v,i)=>v===HEADER[i])) decryptFile(buf,f.name);
 else encryptFile(buf,f.name);
}

async function encryptFile(data,name){
 let salt=crypto.getRandomValues(new Uint8Array(16));
 let iv=crypto.getRandomValues(new Uint8Array(12));
 let k=await key(pass.value,salt);
 let c=new Uint8Array(await crypto.subtle.encrypt({name:"AES-GCM",iv},k,data));

 let out=new Uint8Array([...HEADER,...salt,...iv,...c]);
 download(out,name+".Livan-encryption");
}

async function decryptFile(data,name){
 let salt=data.slice(8,24), iv=data.slice(24,36), cipher=data.slice(36);
 let k=await key(pass.value,salt);
 let p=await crypto.subtle.decrypt({name:"AES-GCM",iv},k,cipher);
 download(p,name.replace(".Livan-encryption",""));
}

function download(data,name){
 let a=document.createElement("a");
 a.href=URL.createObjectURL(new Blob([data]));
 a.download=name;
 a.click();
}
</script>
</body>
</html>
